version: '3'
services:
  boot-node:
    image: ethereumex/bootnode-registrar:node
    hostname: ${HOST_NAME}-b
    restart: always
    volumes:
      - /home/${USERNAME}/eth-node/.geth:/home/eth-node/.geth
    depends_on:
      - ethereum-node
    environment:
      - INSTANCE_NAME=${HOST_NAME}
      - NODE_NAME=${HOST_NAME}
      - HOST_IP=${HOST_IP}
      - BOOTNODE_URL=${BOOTNODE_URL}
      - BOOTNODE_NETWORK=${BOOTNODE_NETWORK}
      - BOOTNODE_PUBLIC_IP=${BOOTNODE_PUBLIC_IP}
      - ETH_IPC_PATH=/home/eth-node/.geth/geth.ipc
    entrypoint:
      - node
      - client.js
  eth-stats-api:
    image: ethereumex/eth-net-intelligence-api:latest-node
    hostname: ${HOST_NAME}-a
    restart: always
    depends_on:
      - ethereum-node
    environment:
      - INSTANCE_NAME=${HOST_NAME}
      - WS_SERVER=${WS_SERVER}
      - WS_SECRET=${WS_SECRET}
      - RPC_HOST=ethereum-node
      - RPC_PORT=8545
      - LISTENING_PORT=30303
  ethereum-node:
    image: ${DOCKER_IMAGE}
    hostname: ${HOST_NAME}-c
    restart: always
    ipc: host
    privileged: true
    environment:
      - INSTANCE_NAME=${HOST_NAME}
      - NODE_NAME=${HOST_NAME}
      - HOST_IP=${HOST_IP}      
      - NETWORKID=${NETWORK_ID}
      - WS_SERVER=${WS_SERVER}
      - WS_SECRET=${WS_SECRET}
      - BOOTNODE_URL=${BOOTNODE_URL}
      - BOOTNODE_NETWORK=${BOOTNODE_NETWORK}
      - ENABLE_MINER=${ENABLE_MINER}
      - MINER_ADDRESS=${MINER_ADDRESS}
      - MINER_THREADS=${MINER_THREADS}
      - EXTERNAL_ARGS=${EXTERNAL_ARGS}
    volumes:
      - /home/${USERNAME}/eth-node/.geth:/home/eth-node/.geth
      - /home/${USERNAME}/eth-node/genesis.json:/home/eth-node/genesis.json
    ports:
      - "30303:30303"
      - "30303:30303/udp"
      - "8545:8545"
      - "8546:8546"
